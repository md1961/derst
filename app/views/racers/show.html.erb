<div class="racers_show">
  <div>
    <%= @racer.name %>
  </div>
  <div style="display: flex;">
    <table class="table_base">
      <tr>
        <th>父</th>
        <% father = @racer.father -%>
        <td><%= safe_join([father&.name, sire_trait_display(father)], '<br>'.html_safe) %></td>
      </tr>
      <tr>
        <th>母</th>
        <% mother = @racer.mother -%>
        <td><%= safe_join([mother&.name, mare_trait_display(mother)], '<br>'.html_safe) %></td>
      </tr>
      <tr>
        <th>母父</th>
        <% father = @racer.mother&.father -%>
        <td><%= safe_join([father&.name, sire_trait_display(father)], '<br>'.html_safe) %></td>
      </tr>
    </table>

    <div id="race_candidates">
      <table class="table_base">
        <tbody>
          <% @racer.race_candidates.group_by { |race|
            [race.month, race.week]
          }.each do |(month, week), races| -%>
            <% races.sort_by! { |r| (r.course.area.location - @racer.stable.center.area.location).abs } -%>
            <tr>
              <td rowspan="<%= races.size %>">
                <%= "#{month}月#{week}週" %>
              </td>
              <td rowspan="<%= races.size %>" class="weeks_later">
                <% weeks_later = @racer.ranch.weeks_later_of(month, week) -%>
                <%= weeks_later.zero? ? '今週' : "#{weeks_later}週後" %>
              </td>
              <%= race_display(races.first) %>
            </tr>
            <% races[1 .. -1].each do |race| -%>
              <tr>
                <%= race_display(race) %>
              </tr>
            <% end -%>
          <% end -%>
        </tbody>
      </table>
    </div>
  </div>
</div>
