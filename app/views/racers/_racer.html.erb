<% shortcut = index < 10 ? index.to_s : ('a'.ord + index - 10).chr -%>

<td class="<%= racer.expecting_race? ? 'expecting_race' : '' %>">
  <%= link_to_if @racer_id_to_edit.zero?, shortcut.upcase, racer, data: {shortcut: shortcut} %></td>
<td><%= link_to_if @racer_id_to_edit.zero?, 'e', ranch_path(@ranch, racer_id_to_edit: racer) %></td>
<td><%= racer_name_display(racer, f) %></td>
<td><%= racer_sex_display(racer) %></td>
<td class="numeric"><%= "#{racer.age}æ­³" %></td>
<% ([:grade] + racer_attr_names).each do |name| -%>
  <%= racer_attr_display_in_td(racer, name, f) %>
<% end -%>

<% if f -%>
  <%= hidden_field_tag :ranch_id, @ranch.id %>

  <td>
  <td>
    <%= f.submit %>
    <%= link_to 'Cancel', @ranch %>
  </td>
<% else -%>
  <td class="numeric">
    <%= racer.results.empty? ? "" : "#{@ranch.month_week - racer.results.last.race.month_week}w" %>
  </td>
  <% racer.target_races.map(&:race).sort_by { |race|
       race.month_week.ordering_from(@ranch.month_week)
     }.each do |race| -%>
    <% n_weeks_between = racer.results.empty? ? nil \
                            : "#{race.month_week - racer.results.last.race.month_week}w" -%>
    <td class="numeric"><%= race.month_week %></td>
    <td class="numeric"><%= n_weeks_between %></td>
    <%= race_display(race, racer) %>
  <% end -%>
<% end -%>
