<% shortcut = index < 10 ? index.to_s : ('a'.ord + index - 10).chr -%>

<td><%= link_to_if @racer_id_to_edit.zero?, shortcut.upcase, racer, data: {shortcut: shortcut} %></td>
<td><%= link_to_if @racer_id_to_edit.zero?, 'e', ranch_path(@ranch, racer_id_to_edit: racer) %></td>
<td><%= racer_name_display(racer, f) %></td>
<td><%= racer_sex_display(racer) %></td>
<td class="numeric"><%= "#{racer.age}æ­³" %></td>
<%= racer_attr_display_in_td(racer, :grade, f) %>

<%= racer_attr_display_in_td(racer, :comment_age2, f) %>
<%= racer_attr_display_in_td(racer, :comment_age3, f) %>
<%= racer_attr_display_in_td(racer, :stable, f) %>
<%= racer_attr_display_in_td(racer, :weight_fat, f) %>
<%= racer_attr_display_in_td(racer, :weight_best , f) %>
<%= racer_attr_display_in_td(racer, :weight_lean, f) %>
<%= racer_attr_display_in_td(racer, :remark, f) %>

<% if f -%>
  <%= hidden_field_tag :ranch_id, @ranch.id %>

  <td>
    <%= f.submit %>
    <%= link_to 'Cancel', @ranch %>
  </td>
<% else -%>
  <% racer.target_races.map(&:race).sort_by { |race|
       race.month_week.ordering_from(@ranch.month_week)
     }.each do |race| -%>
    <% n_weeks_between = racer.results.empty? ? nil \
                            : "#{race.month_week - racer.results.last.race.month_week}w" -%>
    <td class="numeric"><%= race.month_week %></td>
    <td class="numeric"><%= n_weeks_between %></td>
    <%= race_display(race, racer) %>
  <% end -%>
<% end -%>
